{% extends "base.html" %}

{% block title %}{{ t.settings }} - {{ t.site_name }}{% endblock %}

{% block content %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-4 border-bottom">
    <h1 class="h2 page-heading">{{ t.settings }}</h1>
    <div class="btn-toolbar mb-2 mb-md-0">
        <div class="btn-group me-2">
            <button type="button" class="btn btn-sm btn-outline-secondary" id="saveSettings">
                <i class="fas fa-save"></i> {{ t.save_settings }}
            </button>
        </div>
        <button type="button" class="btn btn-sm btn-outline-danger" data-bs-toggle="modal" data-bs-target="#resetModal">
            <i class="fas fa-undo"></i> {{ t.reset_defaults }}
        </button>
    </div>
</div>

<div class="row g-4">
    <!-- Settings Navigation -->
    <div class="col-lg-3">
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-white">
                <h5 class="card-title mb-0">{{ t.navigation }}</h5>
            </div>
            <div class="list-group list-group-flush">
                <a href="#general" class="list-group-item list-group-item-action active" data-bs-toggle="list">
                    <i class="fas fa-cog me-2"></i> {{ t.general }}
                </a>
                <a href="#monitoring" class="list-group-item list-group-item-action" data-bs-toggle="list">
                    <i class="fas fa-satellite me-2"></i> {{ t.monitoring }}
                </a>
                <a href="#notifications" class="list-group-item list-group-item-action" data-bs-toggle="list">
                    <i class="fas fa-bell me-2"></i> {{ t.notifications }}
                </a>
                <a href="#database" class="list-group-item list-group-item-action" data-bs-toggle="list">
                    <i class="fas fa-database me-2"></i> {{ t.database }}
                </a>
                <a href="#web" class="list-group-item list-group-item-action" data-bs-toggle="list">
                    <i class="fas fa-globe me-2"></i> {{ t.web_interface }}
                </a>
                <a href="#weather" class="list-group-item list-group-item-action" data-bs-toggle="list">
                    <i class="fas fa-cloud-sun me-2"></i> {{ t.weather_integration }}
                </a>
                <a href="#users" class="list-group-item list-group-item-action" data-bs-toggle="list">
                    <i class="fas fa-users me-2"></i> {{ t.user_management }}
                </a>
            </div>
        </div>
    </div>
    
    <!-- Settings Content -->
    <div class="col-lg-9">
        <div class="tab-content">
            <!-- General Settings -->
            <div class="tab-pane fade show active" id="general">
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-white">
                        <h5 class="card-title mb-0">{{ t.general_settings }}</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-4">
                            <label for="siteName" class="form-label fw-bold">{{ t.site_name }}</label>
                            <input type="text" class="form-control" id="siteName" value="{{ t.site_name }}">
                        </div>
                        <div class="mb-4">
                            <label for="timezone" class="form-label fw-bold">{{ t.timezone }}</label>
                            <select class="form-select" id="timezone">
                                <option value="UTC">{{ t.timezone_utc }}</option>
                                <option value="America/New_York">{{ t.timezone_eastern }}</option>
                                <option value="Europe/London">{{ t.timezone_london }}</option>
                                <option value="Asia/Tokyo">{{ t.timezone_tokyo }}</option>
                                <option value="Europe/Moscow" selected>{{ t.timezone_moscow }}</option>
                            </select>
                        </div>
                        <div class="mb-4">
                            <label for="language" class="form-label fw-bold">{{ t.language }}</label>
                            <select class="form-select" id="language">
                                <option value="en" {% if session.get('language', 'en') == 'en' %}selected{% endif %}>English</option>
                                <option value="ru" {% if session.get('language', 'en') == 'ru' %}selected{% endif %}>Русский</option>
                                <option value="es">Español</option>
                            </select>
                        </div>
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="autoUpdate" checked>
                            <label class="form-check-label fw-bold" for="autoUpdate">
                                {{ t.auto_update }}
                            </label>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Monitoring Settings -->
            <div class="tab-pane fade" id="monitoring">
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-white">
                        <h5 class="card-title mb-0">{{ t.monitoring_settings }}</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-4">
                            <label for="monitoringInterval" class="form-label fw-bold">{{ t.monitoring_interval }}</label>
                            <input type="number" class="form-control" id="monitoringInterval" value="15" min="1" max="60">
                            <div class="form-text">{{ t.minutes }}</div>
                        </div>
                        <div class="mb-4">
                            <label class="form-label fw-bold">{{ t.speed_test_config }}</label>
                            <div class="form-check form-switch mb-2">
                                <input class="form-check-input" type="checkbox" id="speedTestEnabled" checked>
                                <label class="form-check-label" for="speedTestEnabled">
                                    {{ t.enable_speed_tests }}
                                </label>
                            </div>
                            <div class="form-check form-switch mb-3">
                                <input class="form-check-input" type="checkbox" id="useSpecificServers" checked>
                                <label class="form-check-label" for="useSpecificServers">
                                    {{ t.use_specific_servers }}
                                </label>
                            </div>
                            <input type="text" class="form-control" id="speedTestServers" placeholder="{{ t.server_ids }}" value="23456,12345">
                        </div>
                        <div class="mb-4">
                            <label class="form-label fw-bold">{{ t.ping_test_config }}</label>
                            <div class="form-check form-switch mb-3">
                                <input class="form-check-input" type="checkbox" id="pingTestEnabled" checked>
                                <label class="form-check-label" for="pingTestEnabled">
                                    {{ t.enable_ping_tests }}
                                </label>
                            </div>
                            <div class="row g-3 mb-3">
                                <div class="col-md-6">
                                    <input type="text" class="form-control" placeholder="{{ t.server_name }}" value="Google DNS">
                                </div>
                                <div class="col-md-6">
                                    <input type="text" class="form-control" placeholder="{{ t.ip_address }}" value="8.8.8.8">
                                </div>
                            </div>
                            <div class="row g-3 mb-3">
                                <div class="col-md-6">
                                    <input type="text" class="form-control" placeholder="{{ t.server_name }}" value="Cloudflare">
                                </div>
                                <div class="col-md-6">
                                    <input type="text" class="form-control" placeholder="{{ t.ip_address }}" value="1.1.1.1">
                                </div>
                            </div>
                            <button class="btn btn-sm btn-outline-primary">
                                <i class="fas fa-plus"></i> {{ t.add_server }}
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Notification Settings -->
            <div class="tab-pane fade" id="notifications">
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-white">
                        <h5 class="card-title mb-0">{{ t.notification_settings }}</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-4">
                            <label class="form-label fw-bold">{{ t.telegram_notifications }}</label>
                            <div class="form-check form-switch mb-3">
                                <input class="form-check-input" type="checkbox" id="telegramEnabled" checked>
                                <label class="form-check-label" for="telegramEnabled">
                                    {{ t.enable_telegram }}
                                </label>
                            </div>
                            <div class="mb-3">
                                <label for="telegramBotToken" class="form-label">{{ t.bot_token }}</label>
                                <input type="password" class="form-control" id="telegramBotToken" value="{{ t.placeholder_bot_token }}">
                            </div>
                            <div class="mb-3">
                                <label for="telegramChatId" class="form-label">{{ t.chat_id }}</label>
                                <input type="text" class="form-control" id="telegramChatId" value="{{ t.placeholder_chat_id }}">
                            </div>
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label for="telegramDownloadThreshold" class="form-label">{{ t.download_threshold }}</label>
                                    <input type="number" class="form-control" id="telegramDownloadThreshold" value="50">
                                </div>
                                <div class="col-md-6">
                                    <label for="telegramPingThreshold" class="form-label">{{ t.ping_threshold }}</label>
                                    <input type="number" class="form-control" id="telegramPingThreshold" value="100">
                                </div>
                            </div>
                        </div>
                        <div class="mb-4">
                            <label class="form-label fw-bold">{{ t.email_notifications }}</label>
                            <div class="form-check form-switch mb-3">
                                <input class="form-check-input" type="checkbox" id="emailEnabled">
                                <label class="form-check-label" for="emailEnabled">
                                    {{ t.enable_email }}
                                </label>
                            </div>
                            <div class="mb-3">
                                <label for="smtpServer" class="form-label">{{ t.smtp_server }}</label>
                                <input type="text" class="form-control" id="smtpServer" placeholder="{{ t.smtp_placeholder }}">
                            </div>
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label for="smtpPort" class="form-label">{{ t.port }}</label>
                                    <input type="number" class="form-control" id="smtpPort" value="587">
                                </div>
                                <div class="col-md-6">
                                    <label for="smtpUsername" class="form-label">{{ t.username }}</label>
                                    <input type="text" class="form-control" id="smtpUsername" placeholder="{{ t.email_placeholder }}">
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="smtpPassword" class="form-label">{{ t.password }}</label>
                                <input type="password" class="form-control" id="smtpPassword">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Database Settings -->
            <div class="tab-pane fade" id="database">
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-white">
                        <h5 class="card-title mb-0">{{ t.database_settings }}</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-4">
                            <label for="dbType" class="form-label fw-bold">{{ t.database_type }}</label>
                            <select class="form-select" id="dbType">
                                <option value="sqlite" selected>{{ t.sqlite_embedded }}</option>
                                <option value="postgresql">{{ t.postgresql }}</option>
                                <option value="mysql">{{ t.mysql }}</option>
                            </select>
                        </div>
                        <div id="dbConfigFields">
                            <div class="mb-4">
                                <label for="dbHost" class="form-label fw-bold">{{ t.host }}</label>
                                <input type="text" class="form-control" id="dbHost" value="localhost">
                            </div>
                            <div class="row g-3 mb-4">
                                <div class="col-md-6">
                                    <label for="dbPort" class="form-label fw-bold">{{ t.port }}</label>
                                    <input type="number" class="form-control" id="dbPort" value="5432">
                                </div>
                                <div class="col-md-6">
                                    <label for="dbName" class="form-label fw-bold">{{ t.database_name }}</label>
                                    <input type="text" class="form-control" id="dbName" value="starlink_monitor">
                                </div>
                            </div>
                            <div class="row g-3 mb-4">
                                <div class="col-md-6">
                                    <label for="dbUser" class="form-label fw-bold">{{ t.username }}</label>
                                    <input type="text" class="form-control" id="dbUser" value="monitor_user">
                                </div>
                                <div class="col-md-6">
                                    <label for="dbPassword" class="form-label fw-bold">{{ t.password }}</label>
                                    <input type="password" class="form-control" id="dbPassword">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Web Interface Settings -->
            <div class="tab-pane fade" id="web">
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-white">
                        <h5 class="card-title mb-0">{{ t.web_interface_settings }}</h5>
                    </div>
                    <div class="card-body">
                        <div class="row g-3 mb-4">
                            <div class="col-md-6">
                                <label for="webHost" class="form-label fw-bold">{{ t.host }}</label>
                                <input type="text" class="form-control" id="webHost" value="0.0.0.0">
                            </div>
                            <div class="col-md-6">
                                <label for="webPort" class="form-label fw-bold">{{ t.port }}</label>
                                <input type="number" class="form-control" id="webPort" value="8050">
                            </div>
                        </div>
                        <div class="form-check form-switch mb-4">
                            <input class="form-check-input" type="checkbox" id="webDebug">
                            <label class="form-check-label fw-bold" for="webDebug">
                                {{ t.enable_debug_mode }}
                            </label>
                        </div>
                        <div class="mb-4">
                            <label class="form-label fw-bold">{{ t.authentication }}</label>
                            <div class="form-check form-switch mb-3">
                                <input class="form-check-input" type="checkbox" id="authEnabled" checked>
                                <label class="form-check-label" for="authEnabled">
                                    {{ t.enable_authentication }}
                                </label>
                            </div>
                            <div class="mt-2">
                                <button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#manageUsersModal">
                                    <i class="fas fa-users"></i> {{ t.manage_users }}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Weather Integration Settings -->
            <div class="tab-pane fade" id="weather">
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-white">
                        <h5 class="card-title mb-0">{{ t.weather_integration }}</h5>
                    </div>
                    <div class="card-body">
                        <div class="form-check form-switch mb-4">
                            <input class="form-check-input" type="checkbox" id="weatherEnabled" checked>
                            <label class="form-check-label fw-bold" for="weatherEnabled">
                                {{ t.enable_weather_integration }}
                            </label>
                        </div>
                        <div class="mb-4">
                            <label for="weatherApiKey" class="form-label fw-bold">{{ t.api_key }}</label>
                            <input type="password" class="form-control" id="weatherApiKey" value="YOUR_OPENMETEO_API_KEY">
                        </div>
                        <div class="row g-3 mb-4">
                            <div class="col-md-6">
                                <label for="weatherLatitude" class="form-label fw-bold">{{ t.latitude }}</label>
                                <input type="text" class="form-control" id="weatherLatitude" value="55.7558">
                            </div>
                            <div class="col-md-6">
                                <label for="weatherLongitude" class="form-label fw-bold">{{ t.longitude }}</label>
                                <input type="text" class="form-control" id="weatherLongitude" value="37.6173">
                            </div>
                        </div>
                        <div class="mb-4">
                            <label class="form-label fw-bold">{{ t.weather_parameters }}</label>
                            <div class="form-check form-switch mb-2">
                                <input class="form-check-input" type="checkbox" id="paramTemp" checked>
                                <label class="form-check-label" for="paramTemp">
                                    {{ t.temperature }}
                                </label>
                            </div>
                            <div class="form-check form-switch mb-2">
                                <input class="form-check-input" type="checkbox" id="paramPrecip" checked>
                                <label class="form-check-label" for="paramPrecip">
                                    {{ t.precipitation }}
                                </label>
                            </div>
                            <div class="form-check form-switch mb-2">
                                <input class="form-check-input" type="checkbox" id="paramWind" checked>
                                <label class="form-check-label" for="paramWind">
                                    {{ t.wind_speed }}
                                </label>
                            </div>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="paramCloud" checked>
                                <label class="form-check-label" for="paramCloud">
                                    {{ t.cloud_cover }}
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- User Management -->
            <div class="tab-pane fade" id="users">
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-white">
                        <h5 class="card-title mb-0">{{ t.user_management }}</h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive mb-4">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>{{ t.username }}</th>
                                        <th>{{ t.role }}</th>
                                        <th>{{ t.last_login }}</th>
                                        <th>{{ t.actions }}</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>admin</td>
                                        <td>{{ t.administrator }}</td>
                                        <td>2025-11-09 14:30:22</td>
                                        <td>
                                            <button class="btn btn-sm btn-outline-primary me-1">{{ t.edit }}</button>
                                            <button class="btn btn-sm btn-outline-danger">{{ t.delete }}</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addUserModal">
                            <i class="fas fa-user-plus"></i> {{ t.add_user }}
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Reset Modal -->
<div class="modal fade" id="resetModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">{{ t.reset_defaults }}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="{{ t.close }}"></button>
            </div>
            <div class="modal-body">
                <p>{{ t.reset_confirmation }}</p>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="confirmReset">
                    <label class="form-check-label" for="confirmReset">
                        {{ t.confirm_reset }}
                    </label>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{{ t.cancel }}</button>
                <button type="button" class="btn btn-danger" id="confirmResetBtn" disabled>{{ t.reset_defaults }}</button>
            </div>
        </div>
    </div>
</div>

<!-- Add User Modal -->
<div class="modal fade" id="addUserModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">{{ t.add_new_user }}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="{{ t.close }}"></button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="mb-3">
                        <label for="newUsername" class="form-label">{{ t.username }}</label>
                        <input type="text" class="form-control" id="newUsername" placeholder="{{ t.enter_username }}">
                    </div>
                    <div class="mb-3">
                        <label for="newPassword" class="form-label">{{ t.password }}</label>
                        <input type="password" class="form-control" id="newPassword" placeholder="{{ t.enter_password }}">
                    </div>
                    <div class="mb-3">
                        <label for="newRole" class="form-label">{{ t.role }}</label>
                        <select class="form-select" id="newRole">
                            <option value="user">{{ t.user }}</option>
                            <option value="admin">{{ t.administrator }}</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{{ t.cancel }}</button>
                <button type="button" class="btn btn-primary">{{ t.add_user }}</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Set up save settings button
        document.getElementById('saveSettings').addEventListener('click', function() {
            saveSettings();
        });
        
        // Set up reset confirmation
        document.getElementById('confirmReset').addEventListener('change', function() {
            document.getElementById('confirmResetBtn').disabled = !this.checked;
        });
        
        // Set up confirm reset button
        document.getElementById('confirmResetBtn').addEventListener('click', function() {
            resetSettings();
        });
        
        // Update database config fields based on type
        document.getElementById('dbType').addEventListener('change', function() {
            updateDatabaseFields(this.value);
        });
        
        // Initialize database fields
        updateDatabaseFields('sqlite');
        
        // Set up language change handler
        document.getElementById('language').addEventListener('change', function() {
            const selectedLang = this.value;
            window.location.href = '/set_language/' + selectedLang;
        });
    });
    
    function saveSettings() {
        // Save settings to server
        // Implementation would go here
        alert('{{ t.settings_saved }}');
    }
    
    function resetSettings() {
        // Reset settings to defaults
        // Implementation would go here
        document.querySelector('[data-bs-dismiss="modal"]').click();
        alert('{{ t.settings_reset }}');
    }
    
    function updateDatabaseFields(dbType) {
        const dbConfigFields = document.getElementById('dbConfigFields');
        if (dbType === 'sqlite') {
            dbConfigFields.style.display = 'none';
        } else {
            dbConfigFields.style.display = 'block';
        }
    }
</script>
{% endblock %}