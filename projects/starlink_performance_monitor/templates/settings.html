{% extends "base.html" %}

{% block title %}Settings - Starlink Monitor{% endblock %}

{% block content %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">Settings</h1>
    <div class="btn-toolbar mb-2 mb-md-0">
        <div class="btn-group me-2">
            <button type="button" class="btn btn-sm btn-outline-secondary" id="saveSettings">
                <i class="fas fa-save"></i> Save Settings
            </button>
        </div>
        <button type="button" class="btn btn-sm btn-outline-danger" data-bs-toggle="modal" data-bs-target="#resetModal">
            <i class="fas fa-undo"></i> Reset to Defaults
        </button>
    </div>
</div>

<!-- Settings Navigation -->
<div class="row">
    <div class="col-md-3">
        <div class="list-group">
            <a href="#general" class="list-group-item list-group-item-action active" data-bs-toggle="list">
                <i class="fas fa-cog"></i> General
            </a>
            <a href="#monitoring" class="list-group-item list-group-item-action" data-bs-toggle="list">
                <i class="fas fa-satellite"></i> Monitoring
            </a>
            <a href="#notifications" class="list-group-item list-group-item-action" data-bs-toggle="list">
                <i class="fas fa-bell"></i> Notifications
            </a>
            <a href="#database" class="list-group-item list-group-item-action" data-bs-toggle="list">
                <i class="fas fa-database"></i> Database
            </a>
            <a href="#web" class="list-group-item list-group-item-action" data-bs-toggle="list">
                <i class="fas fa-globe"></i> Web Interface
            </a>
            <a href="#weather" class="list-group-item list-group-item-action" data-bs-toggle="list">
                <i class="fas fa-cloud-sun"></i> Weather Integration
            </a>
            <a href="#users" class="list-group-item list-group-item-action" data-bs-toggle="list">
                <i class="fas fa-users"></i> User Management
            </a>
        </div>
    </div>
    
    <!-- Settings Content -->
    <div class="col-md-9">
        <div class="tab-content">
            <!-- General Settings -->
            <div class="tab-pane fade show active" id="general">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title">General Settings</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="siteName" class="form-label">Site Name</label>
                            <input type="text" class="form-control" id="siteName" value="Starlink Performance Monitor">
                        </div>
                        <div class="mb-3">
                            <label for="timezone" class="form-label">Timezone</label>
                            <select class="form-select" id="timezone">
                                <option value="UTC">UTC</option>
                                <option value="America/New_York">Eastern Time (US & Canada)</option>
                                <option value="Europe/London">London</option>
                                <option value="Asia/Tokyo">Tokyo</option>
                                <option value="Europe/Moscow" selected>Moscow</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="language" class="form-label">Language</label>
                            <select class="form-select" id="language">
                                <option value="en">English</option>
                                <option value="ru" selected>Русский</option>
                                <option value="es">Español</option>
                            </select>
                        </div>
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="autoUpdate" checked>
                            <label class="form-check-label" for="autoUpdate">
                                Automatically check for updates
                            </label>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Monitoring Settings -->
            <div class="tab-pane fade" id="monitoring">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title">Monitoring Settings</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="monitoringInterval" class="form-label">Monitoring Interval (minutes)</label>
                            <input type="number" class="form-control" id="monitoringInterval" value="15" min="1" max="60">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Speed Test Configuration</label>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="speedTestEnabled" checked>
                                <label class="form-check-label" for="speedTestEnabled">
                                    Enable Speed Tests
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="useSpecificServers" checked>
                                <label class="form-check-label" for="useSpecificServers">
                                    Use Specific Speed Test Servers
                                </label>
                            </div>
                            <input type="text" class="form-control mt-2" id="speedTestServers" placeholder="Server IDs (comma separated)" value="23456,12345">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Ping Test Configuration</label>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="pingTestEnabled" checked>
                                <label class="form-check-label" for="pingTestEnabled">
                                    Enable Ping Tests
                                </label>
                            </div>
                            <div class="row mt-2">
                                <div class="col-md-6">
                                    <input type="text" class="form-control" placeholder="Server Name" value="Google DNS">
                                </div>
                                <div class="col-md-6">
                                    <input type="text" class="form-control" placeholder="IP Address" value="8.8.8.8">
                                </div>
                            </div>
                            <div class="row mt-2">
                                <div class="col-md-6">
                                    <input type="text" class="form-control" placeholder="Server Name" value="Cloudflare">
                                </div>
                                <div class="col-md-6">
                                    <input type="text" class="form-control" placeholder="IP Address" value="1.1.1.1">
                                </div>
                            </div>
                            <button class="btn btn-sm btn-outline-primary mt-2">
                                <i class="fas fa-plus"></i> Add Server
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Notification Settings -->
            <div class="tab-pane fade" id="notifications">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title">Notification Settings</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label">Telegram Notifications</label>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="telegramEnabled" checked>
                                <label class="form-check-label" for="telegramEnabled">
                                    Enable Telegram Notifications
                                </label>
                            </div>
                            <div class="mb-2">
                                <label for="telegramBotToken" class="form-label">Bot Token</label>
                                <input type="password" class="form-control" id="telegramBotToken" value="YOUR_BOT_TOKEN_HERE">
                            </div>
                            <div class="mb-2">
                                <label for="telegramChatId" class="form-label">Chat ID</label>
                                <input type="text" class="form-control" id="telegramChatId" value="YOUR_CHAT_ID_HERE">
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <label for="telegramDownloadThreshold" class="form-label">Download Threshold (Mbps)</label>
                                    <input type="number" class="form-control" id="telegramDownloadThreshold" value="50">
                                </div>
                                <div class="col-md-6">
                                    <label for="telegramPingThreshold" class="form-label">Ping Threshold (ms)</label>
                                    <input type="number" class="form-control" id="telegramPingThreshold" value="100">
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Email Notifications</label>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="emailEnabled">
                                <label class="form-check-label" for="emailEnabled">
                                    Enable Email Notifications
                                </label>
                            </div>
                            <div class="mb-2">
                                <label for="smtpServer" class="form-label">SMTP Server</label>
                                <input type="text" class="form-control" id="smtpServer" placeholder="smtp.gmail.com">
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <label for="smtpPort" class="form-label">Port</label>
                                    <input type="number" class="form-control" id="smtpPort" value="587">
                                </div>
                                <div class="col-md-6">
                                    <label for="smtpUsername" class="form-label">Username</label>
                                    <input type="text" class="form-control" id="smtpUsername" placeholder="your.email@gmail.com">
                                </div>
                            </div>
                            <div class="mb-2">
                                <label for="smtpPassword" class="form-label">Password</label>
                                <input type="password" class="form-control" id="smtpPassword">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Database Settings -->
            <div class="tab-pane fade" id="database">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title">Database Settings</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="dbType" class="form-label">Database Type</label>
                            <select class="form-select" id="dbType">
                                <option value="sqlite" selected>SQLite (Embedded)</option>
                                <option value="postgresql">PostgreSQL</option>
                                <option value="mysql">MySQL</option>
                            </select>
                        </div>
                        <div id="dbConfigFields">
                            <div class="mb-3">
                                <label for="dbHost" class="form-label">Host</label>
                                <input type="text" class="form-control" id="dbHost" value="localhost">
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <label for="dbPort" class="form-label">Port</label>
                                    <input type="number" class="form-control" id="dbPort" value="5432">
                                </div>
                                <div class="col-md-6">
                                    <label for="dbName" class="form-label">Database Name</label>
                                    <input type="text" class="form-control" id="dbName" value="starlink_monitor">
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <label for="dbUser" class="form-label">Username</label>
                                    <input type="text" class="form-control" id="dbUser" value="monitor_user">
                                </div>
                                <div class="col-md-6">
                                    <label for="dbPassword" class="form-label">Password</label>
                                    <input type="password" class="form-control" id="dbPassword">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Web Interface Settings -->
            <div class="tab-pane fade" id="web">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title">Web Interface Settings</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="webHost" class="form-label">Host</label>
                                    <input type="text" class="form-control" id="webHost" value="0.0.0.0">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="webPort" class="form-label">Port</label>
                                    <input type="number" class="form-control" id="webPort" value="8050">
                                </div>
                            </div>
                        </div>
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="webDebug">
                            <label class="form-check-label" for="webDebug">
                                Enable Debug Mode
                            </label>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Authentication</label>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="authEnabled" checked>
                                <label class="form-check-label" for="authEnabled">
                                    Enable Authentication
                                </label>
                            </div>
                            <div class="mt-2">
                                <button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#manageUsersModal">
                                    <i class="fas fa-users"></i> Manage Users
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Weather Integration Settings -->
            <div class="tab-pane fade" id="weather">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title">Weather Integration</h5>
                    </div>
                    <div class="card-body">
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="weatherEnabled" checked>
                            <label class="form-check-label" for="weatherEnabled">
                                Enable Weather Integration
                            </label>
                        </div>
                        <div class="mb-3">
                            <label for="weatherApiKey" class="form-label">API Key</label>
                            <input type="password" class="form-control" id="weatherApiKey" value="YOUR_OPENMETEO_API_KEY">
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <label for="weatherLatitude" class="form-label">Latitude</label>
                                <input type="text" class="form-control" id="weatherLatitude" value="55.7558">
                            </div>
                            <div class="col-md-6">
                                <label for="weatherLongitude" class="form-label">Longitude</label>
                                <input type="text" class="form-control" id="weatherLongitude" value="37.6173">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Weather Parameters</label>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="paramTemp" checked>
                                <label class="form-check-label" for="paramTemp">
                                    Temperature
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="paramPrecip" checked>
                                <label class="form-check-label" for="paramPrecip">
                                    Precipitation
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="paramWind" checked>
                                <label class="form-check-label" for="paramWind">
                                    Wind Speed
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="paramCloud" checked>
                                <label class="form-check-label" for="paramCloud">
                                    Cloud Cover
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- User Management -->
            <div class="tab-pane fade" id="users">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title">User Management</h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Username</th>
                                        <th>Role</th>
                                        <th>Last Login</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>admin</td>
                                        <td>Administrator</td>
                                        <td>2025-11-09 14:30:22</td>
                                        <td>
                                            <button class="btn btn-sm btn-outline-primary">Edit</button>
                                            <button class="btn btn-sm btn-outline-danger">Delete</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addUserModal">
                            <i class="fas fa-user-plus"></i> Add User
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Reset Modal -->
<div class="modal fade" id="resetModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Reset to Defaults</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to reset all settings to their default values? This action cannot be undone.</p>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="confirmReset">
                    <label class="form-check-label" for="confirmReset">
                        Yes, I want to reset all settings
                    </label>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirmResetBtn" disabled>Reset to Defaults</button>
            </div>
        </div>
    </div>
</div>

<!-- Add User Modal -->
<div class="modal fade" id="addUserModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add New User</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="mb-3">
                        <label for="newUsername" class="form-label">Username</label>
                        <input type="text" class="form-control" id="newUsername" placeholder="Enter username">
                    </div>
                    <div class="mb-3">
                        <label for="newPassword" class="form-label">Password</label>
                        <input type="password" class="form-control" id="newPassword" placeholder="Enter password">
                    </div>
                    <div class="mb-3">
                        <label for="newRole" class="form-label">Role</label>
                        <select class="form-select" id="newRole">
                            <option value="user">User</option>
                            <option value="admin">Administrator</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary">Add User</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Set up save settings button
        document.getElementById('saveSettings').addEventListener('click', function() {
            saveSettings();
        });
        
        // Set up reset confirmation
        document.getElementById('confirmReset').addEventListener('change', function() {
            document.getElementById('confirmResetBtn').disabled = !this.checked;
        });
        
        // Set up confirm reset button
        document.getElementById('confirmResetBtn').addEventListener('click', function() {
            resetSettings();
        });
        
        // Update database config fields based on type
        document.getElementById('dbType').addEventListener('change', function() {
            updateDatabaseFields(this.value);
        });
        
        // Initialize database fields
        updateDatabaseFields('sqlite');
    });
    
    function saveSettings() {
        // Save settings to server
        // Implementation would go here
        alert('Settings saved successfully!');
    }
    
    function resetSettings() {
        // Reset settings to defaults
        // Implementation would go here
        document.querySelector('[data-bs-dismiss="modal"]').click();
        alert('Settings reset to defaults.');
    }
    
    function updateDatabaseFields(dbType) {
        const dbConfigFields = document.getElementById('dbConfigFields');
        if (dbType === 'sqlite') {
            dbConfigFields.style.display = 'none';
        } else {
            dbConfigFields.style.display = 'block';
        }
    }
</script>
{% endblock %}